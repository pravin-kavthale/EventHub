{% extends 'base/base.html' %}
{% block title %}Joined Events{% endblock title %}
{% block breadcrumb %}Joined Events{% endblock breadcrumb %}
{% load static %}

{% block content %}
<style>
    body {
        background: #0f0f16;
        font-family: "Inter", sans-serif;
    }

    .summary-card {
        background: #3b3b3b;
        border-radius: 8px;
        padding: 15px 10px;
        min-height: 180px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        text-align: center;
        color: #d8d8e6;
        transition: 0.25s ease;
    }

    .summary-card h2 {
        font-size: 42px;
        font-weight: 700;
        margin: 0;
        color: #ffffff;
    }

    .summary-card p {
        font-size: 17px;
        margin-top: 6px;
        font-weight: 600;
    }

    .summary-card.highlight {
        background: #7e5fdc !important;
        color: #fff !important;
        box-shadow: inset 0 0 12px rgba(255,255,255,0.22);
    }
</style>

<div class="container mt-4">

    <!-- TOP SUMMARY CARDS -->
    <div class="row g-4 mb-4">

        <div class="col-md-3">
            <a href="{% url 'joined_events' %}" class="text-decoration-none">
                <div class="summary-card {% if current_status == 'all' or not current_status %}highlight{% endif %}">
                    <p>All Joined Events</p>
                    <h2>{{ total_events }}</h2>
                </div>
            </a>
        </div>

        <div class="col-md-3">
            <a href="?status=ongoing" class="text-decoration-none">
                <div class="summary-card {% if current_status == 'ongoing' %}highlight{% endif %}">
                    <p>Ongoing</p>
                    <h2>{{ ongoing_events_count }}</h2>
                </div>
            </a>
        </div>

        <div class="col-md-3">
            <a href="?status=upcoming" class="text-decoration-none">
                <div class="summary-card {% if current_status == 'upcoming' %}highlight{% endif %}">
                    <p>Upcoming</p>
                    <h2>{{ upcoming_events_count }}</h2>
                </div>
            </a>
        </div>

        <div class="col-md-3">
            <a href="?status=completed" class="text-decoration-none">
                <div class="summary-card {% if current_status == 'completed' %}highlight{% endif %}">
                    <p>Completed</p>
                    <h2>{{ completed_events_count }}</h2>
                </div>
            </a>
        </div>

    </div>

    <!-- EVENT CARDS -->
    <div class="row g-4">

        {% for event in events %}
            {% include "Event/event_card.html" %}
        {% empty %}
            <div class="col-12 text-center">
                <div class="alert alert-info">No joined events found.</div>
            </div>
        {% endfor %}

    </div>

    <!-- QR MODAL (ONCE) -->
    <div class="modal fade" id="qrModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content text-center p-3">
                <h5 class="mb-3">Your Event QR Code</h5>
                <img id="qrImage" src="" class="img-fluid" alt="QR Code">
                <button class="btn btn-secondary mt-3" data-bs-dismiss="modal">
                    Close
                </button>
            </div>
        </div>
    </div>

</div>
{% endblock content %}


{% block extrascript %}
<script>
document.addEventListener("DOMContentLoaded", function () {

    const modalEl = document.getElementById("qrModal");
    if (!modalEl || typeof bootstrap === "undefined") return;

    const modal = new bootstrap.Modal(modalEl);
    const qrImage = document.getElementById("qrImage");

    document.querySelectorAll(".qr-btn").forEach(btn => {
        btn.addEventListener("click", function () {
            qrImage.src = this.dataset.qrUrl;
            modal.show();
        });
    });

});
</script>
{% endblock extrascript %}
