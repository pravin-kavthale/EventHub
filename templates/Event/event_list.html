{% extends 'base/base.html' %}
{% block title %}Events{% endblock title %}
{% block breadcrumb %}Events{% endblock breadcrumb %}
{% load static %}

{% block content %}
<style>
    body {
        background: #0f0f16;
        font-family: "Inter", sans-serif;
    }

    .card {
        border-radius: 14px;
        overflow: hidden;
        box-shadow: 0 6px 18px rgba(0,0,0,0.35);
        transition: transform 0.25s, box-shadow 0.25s;
        background: #14141f;
        color: #d8d8e6;
    }

    .card:hover {
        transform: translateY(-6px);
        box-shadow: 0 12px 28px rgba(138, 92, 246, 0.6);
    }

    /* Pagination */
    .pagination {
        gap: 10px;
    }

    .page-link {
        background: #1c1c2b;
        color: #c7c7ff;
        border: none;
        border-radius: 999px;
        padding: 10px 18px;
        font-weight: 500;
        transition: all 0.25s ease;
        box-shadow: inset 0 0 0 1px rgba(255,255,255,0.06);
    }

    .page-link:hover {
        background: linear-gradient(135deg, #7c5cff, #b86adf);
        color: #fff;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(124, 92, 255, 0.45);
    }

    .page-item.active .page-link {
        background: linear-gradient(135deg, #ec4899, #f43f5e);
        color: #fff;
        font-weight: 600;
        box-shadow: 0 8px 24px rgba(236,72,153,0.6);
    }

    .page-item.disabled .page-link {
        opacity: 0.4;
        pointer-events: none;
    }
</style>

<div class="container-fluid">

    <!-- Header -->
    <div class="row mb-4">
        <div class="col">
            <h5 class="text-light">
                Events You May Be Interested In
            </h5>
        </div>
    </div>

    <!-- Search + Category -->
    <div class="row mb-4 align-items-center">
        <div class="col-md-6">
            <!-- IMPORTANT: search goes to SEARCH view, not this view -->
            <form method="get" action="{% url 'event_search' %}" class="d-flex">
                <input
                    type="text"
                    name="q"
                    class="form-control me-2"
                    placeholder="Search events..."
                >
                <button class="btn btn-outline-primary" type="submit">
                    <i class="fas fa-search"></i>
                </button>
            </form>
        </div>

        <div class="col-md-6 d-flex justify-content-end align-items-center">
            <form method="get" class="me-2">
                <select
                    name="category"
                    class="form-select w-auto"
                    onchange="this.form.submit()"
                >
                    <option value="">All Categories</option>
                    {% for cat in categories %}
                        <option
                            value="{{ cat.id }}"
                            {% if selected_category == cat.id|stringformat:"s" %}selected{% endif %}
                        >
                            {{ cat.name }}
                        </option>
                    {% endfor %}
                </select>
            </form>

            <a href="{% url 'create_event' %}" class="btn btn-primary">
                <i class="fas fa-plus-circle me-1"></i> Create Event
            </a>
        </div>
    </div>

    <!-- Events -->
    <div class="row g-4">
        {% for event in events %}
            {% include "Event/event_card.html" %}
        {% empty %}
            <div class="col-12 text-center">
                <div class="alert alert-info">
                    No events available.
                </div>
            </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if is_paginated %}
    <div class="d-flex justify-content-center mt-5">
        <nav>
            <ul class="pagination pagination-lg">

                {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link"
                       href="?page={{ page_obj.previous_page_number }}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}">
                        ← Prev
                    </a>
                </li>
                {% endif %}

                {% for num in page_obj.paginator.page_range %}
                <li class="page-item {% if page_obj.number == num %}active{% endif %}">
                    <a class="page-link"
                       href="?page={{ num }}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}">
                        {{ num }}
                    </a>
                </li>
                {% endfor %}

                {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link"
                       href="?page={{ page_obj.next_page_number }}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}">
                        Next →
                    </a>
                </li>
                {% endif %}

            </ul>
        </nav>
    </div>
    {% endif %}

</div>
{% endblock content %}
